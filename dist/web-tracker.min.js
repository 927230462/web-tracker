var webTracker=function(){"use strict";function g(e){return`${e}`.split(".")[0]}function e(e){"complete"===document.readyState?e():window.addEventListener("load",e)}const t=e=>{console.log(`%c ${e}`,"color:red")};var o=new class{constructor(){this.xhr=new XMLHttpRequest}init(e){this.appCode=e.appCode,this.host=e.host,this.version=e.version,this.project=e.host,this.logstore=e.host,this.url=`https://${e.project}.${e.host}/logstores/${e.logstore}/track`}_getData(e={}){let t={...{appCode:this.appCode,version:this.version,pageTitle:document.title,pageUrl:location.href,timestamp:Date.now(),userAgent:navigator.userAgent},...e};for(var o in t)"number"==typeof t[o]&&(t[o]=""+t[o]);return t}_validate(e){return e.appCode?e.version?e.logType?e.logCode?!!e.logName||(t("请先设置目标对象名称[logName]"),!1):(t("请先设置目标对象代码[logCode]"),!1):(t("请先设置项目类型[logType]"),!1):(t("请先设置项目版本号[version]"),!1):(t("请先设置项目代码[appCode]"),!1)}send(e={},t){var o=e.method;switch(delete e.method,o){case"POST":this.sendPost(e,t);break;case"GET":this.sendGet(e,t);break;case"IMG":this.sendImg(e,t);break;default:this.sendPost(e,t)}}sendPost(e={},t){e=this._getData(e);this._validate(e)&&(e=JSON.stringify({__logs__:[e]}),this.xhr.open("POST",this.url,!0),this.xhr.setRequestHeader("Content-Type","application/json;charset=UTF-8"),this.xhr.setRequestHeader("x-log-apiversion","0.6.0"),this.xhr.setRequestHeader("x-log-bodyrawsize",e.length),this.xhr.onload=function(){(200<=this.status&&this.status<=300||304==this.status)&&(m.next(),t&&t())},this.xhr.onerror=function(e){m.next(),t&&t(),console.log("error",e)},this.xhr.send(e))}sendGet(e={},o){let n=this._getData(e);if(this._validate(n)){let t="";Object.keys(n).forEach(function(e){t+="&"+e+"="+n[e]});e=`https://${this.project}.${this.host}/logstores/${this.logstore}/track_ua.gif?APIVersion=0.6.0`+t;this.xhr.open("GET",e,!0),this.xhr.onload=function(){(200<=this.status&&this.status<=300||304==this.status)&&(m.next(),o&&o())},this.xhr.onerror=function(e){m.next(),o&&o(),console.log("error",e)},this.xhr.send()}}sendImg(e={},t){let o=this._getData(e);var n;this._validate(o)&&(n="",Object.keys(o).forEach(function(e){n+="&"+e+"="+o[e]}),(e=document.createElement("img")).setAttribute("class","img-responsive"),e.src=`https://${this.project}.${this.host}/logstores/${this.logstore}/track_ua.gif?APIVersion=0.6.0`+n)}};var m=new class{constructor(){this.state="NULL",this.list=[]}add(e){this.list.push(e),"RUNING"!==this.state&&(this.next(),this.state="RUNING")}next(){console.log(this.list);var e=this.list.shift();e&&o.send(e,()=>{this.state="NULL"})}};let d;["click","pointerdown","touchstart","mousedown","keydown","mouseover"].forEach(e=>{document.addEventListener(e,e=>{d=e},{capture:!0,passive:!0})});const n=function(e){return e.reverse().filter(function(e){return e!==window&&e!==document}).map(function(e){e=e.id?`#${e.id}`:e.className&&"string"==typeof e.className?"."+e.className.split(" ").filter(function(e){return!!e}).join("."):e.nodeName;return e}).join(" ")};function l(e){if(Array.isArray(e))return n(e);for(var t=[],o=e;o;)t.push(o),o=o.parentNode;return n(t)}function s(e){e=e.id?`#${e.id}`:e.className&&"string"==typeof e.className?"."+e.className.split(" ").filter(function(e){return!!e}).join("."):e.nodeName.toLowerCase();return e}return new class{constructor(){this.report={PV:!1,PERFORMANCE:!1,JS_ERROR:!0,XHR_ERROR:!0,CONSOLE_ERROR:!1,TIME_ON_PAGE:!1,LONG_TASK:!1,BLANK_SCREEN:!1}}install(e,t){this.init(t),e.prototype.$webTracker=this}init(e){this.report=function(e,t){for(var o in t)e[o]=t[o];return e}(this.report,(e=e||{}).report||{}),e.report=this.report,this.config=e,o.init(this.config),this._init()}send(e,t){m.add(e,t)}_init(){var t;window.addEventListener("error",function(e){var t=d;e.target&&(e.target.src||e.target.href)?m.add({logType:"monitor",logCode:"RESOURCE_ERROR",logName:"资源加载错误",filename:e.target.src||e.target.href,tagName:e.target.tagName,elementType:l(e.path||e.target)}):m.add({logType:"monitor",logCode:"JS_ERROR",logName:"JS错误",message:e.message,filename:e.filename,position:(e.lineno||0)+":"+(e.colno||0),stack:e.error.stack,elementType:t?l(t.path||t.target):""})},!0),window.addEventListener("unhandledrejection",function(e){var t=d;let o="",n=0,r=0,s="",i="";"string"==typeof e.reason?o=e.reason:"object"==typeof e.reason&&(o=e.reason.message);let a=e.reason;"object"==typeof a&&a.stack&&((e=a.stack.match(/at\s+(.+):(\d+):(\d+)/))&&(s=e[1],n=e[2],r=e[3]),i=a.stack),m.add({logType:"monitor",logCode:"PROMISE_ERROR",logName:"Promise错误",elementType:t?l(t.path||t.target):"",message:o,filename:s,position:n+":"+r,stack:i})},!0),console.error=(t=console.error,function(e){"string"==typeof e?m.add({logType:"monitor",type:"ERROR",logCode:"CONSOLE_ERROR",logName:"控制台错误",message:e,elementType:"page"}):"object"==typeof e&&m.add({logType:"monitor",logCode:"CONSOLE_ERROR",logName:"控制台错误",message:e.message,stack:e.stack,elementType:"page"}),t.call(console,e)}),this.report&&this.report.BLANK_SCREEN&&function(){const t=["body","html","#app"];let n=0;function r(e){e=s(e);0<=t.indexOf(e)&&n++}e(function(){var t,o,e;for(let e=1;e<=9;e++)t=document.elementsFromPoint(window.innerWidth*e/10,window.innerHeight/2),o=document.elementsFromPoint(window.innerWidth/2,window.innerHeight*e/10),r(t[0]),r(o[0]);0<=n&&(e=document.elementsFromPoint(window.innerWidth/2,window.innerHeight/2),m.add({logType:"monitor",logCode:"BLANK_SCREEN",logName:"白屏",emptyPoints:""+n,screen:window.screen.width+"x"+window.screen.height,viewPoint:window.innerWidth+"x"+window.innerHeight,elementType:s(e[0])}))})}(),this.report&&this.report.LONG_TASK&&new PerformanceObserver(e=>{e.getEntries().forEach(e=>{100<e.duration&&requestIdleCallback(()=>{m.add({logType:"monitor",logCode:"LONG_TASK",logName:"卡顿",eventType:lastEvent.type,startTime:g(e.startTime),duration:g(e.duration)})})})}).observe({entryTypes:["longtask"]}),this.report&&this.report.PERFORMANCE&&function(){let h,p;new PerformanceObserver((e,t)=>{e=e.getEntries();h=e[0],t.disconnect()}).observe({entryTypes:["element"]}),new PerformanceObserver((e,t)=>{e=e.getEntries(),e=e[e.length-1];p=e,t.disconnect()}).observe({entryTypes:["largest-contentful-paint"]}),new PerformanceObserver(function(e,t){var o,n=e.getEntries()[0];n&&(o=n.processingStart-n.startTime,e=n.duration,(0<n||0<e)&&m.add({logType:"monitor",logCode:"PERFORMANCE_FIRST_INPUT_DELAY",logName:"第一输入延迟",elementType:"page",inputDelay:o?g(o):0,duration:e?g(e):0,startTime:n.startTime})),t.disconnect()}).observe({type:"first-input",buffered:!0}),e(function(){setTimeout(()=>{var{fetchStart:e,connectStart:t,connectEnd:o,requestStart:n,responseStart:r,responseEnd:s,domLoading:i,domInteractive:a,domContentLoadedEventStart:d,domContentLoadedEventEnd:l,loadEventStart:c}=performance.timing;log.send({logType:"monitor",logCode:"PERFORMANCE_TMING",logName:"性能计时",elementType:"page",connectTime:o-t,ttfbTime:r-n,responseTime:s-r,parseDOMTime:c-i,domContentLoadedTime:l-d,timeToInteractive:a-e,loadTime:c-e});c=performance.getEntriesByName("first-paint")[0],e=performance.getEntriesByName("first-contentful-paint")[0];m.add({logType:"monitor",logCode:"PERFORMANCE_PAINT",logName:"首次绘制",elementType:"page",firstPaint:c?g(c.startTime):0,firstContentPaint:e?g(e.startTime):0,firstMeaningfulPaint:h?g(h.startTime):0,largestContentfulPaint:p?g(p.renderTime||p.loadTime):0})},3e3)})}(),this.report&&this.report.PV&&function(){var e=navigator.connection;m.add({logType:"monitor",logCode:"PV",logName:"PV",elementType:"page",effectiveType:e.effectiveType,rtt:e.rtt,screen:`${window.screen.width}x${window.screen.height}`});let t=Date.now();window.addEventListener("unload",()=>{var e=Date.now()-t;m.add({logType:"monitor",logCode:"STAY_TIME",logName:"在线时长",elementType:"page",stayTime:e})},!1)}()}}}();
