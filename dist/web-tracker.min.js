var webTracker=function(){"use strict";function g(e){return`${e}`.split(".")[0]}function e(e){"complete"===document.readyState?e():window.addEventListener("load",e)}const t=e=>{console.log(`%c ${e}`,"color:red")};function n(e,t){for(var n in t)e[n]=t[n];return e}var h=new class{constructor(){this.xhr=new XMLHttpRequest}init(e){this.appCode=e.appCode,this.host=e.host,this.version=e.version,this.project=e.host,this.logstore=e.host,this.url=`https://${e.project}.${e.host}/logstores/${e.logstore}/track`}_getData(){return{appCode:this.appCode,version:this.version,pageTitle:document.title,pageUrl:location.href,timestamp:Date.now(),userAgent:navigator.userAgent}}_validate(e){return e.appCode?e.version?e.logType?e.logCode?!!e.logName||(t("请先设置目标对象名称[logName]"),!1):(t("请先设置目标对象代码[logCode]"),!1):(t("请先设置项目类型[logType]"),!1):(t("请先设置项目版本号[version]"),!1):(t("请先设置项目代码[appCode]"),!1)}send(e={},t){let n={...this._getData(),...e};for(var o in n)"number"==typeof n[o]&&(n[o]=""+n[o]);this._validate(n)&&(e=JSON.stringify({__logs__:[n]}),this.xhr.open("POST",this.url,!0),this.xhr.setRequestHeader("Content-Type","application/json;charset=UTF-8"),this.xhr.setRequestHeader("x-log-apiversion","0.6.0"),this.xhr.setRequestHeader("x-log-bodyrawsize",e.length),this.xhr.onload=function(){(200<=this.status&&this.status<=300||304==this.status)&&t&&t()},this.xhr.onerror=function(e){console.log("error",e)},this.xhr.send(e))}};let l;function d(e){return e?e.split("\n").slice(1).map(e=>e.replace(/^\s+at\s+/g,"")).join("^"):""}["click","pointerdown","touchstart","mousedown","keydown","mouseover"].forEach(e=>{document.addEventListener(e,e=>{l=e},{capture:!0,passive:!0})});const o=function(e){return e.reverse().filter(function(e){return e!==window&&e!==document}).map(function(e){e=e.id?`#${e.id}`:e.className&&"string"==typeof e.className?"."+e.className.split(" ").filter(function(e){return!!e}).join("."):e.nodeName;return e}).join(" ")};function c(e){if(Array.isArray(e))return o(e);for(var t=[],n=e;n;)t.push(n),n=n.parentNode;return o(t)}function i(e){e=e.id?`#${e.id}`:e.className&&"string"==typeof e.className?"."+e.className.split(" ").filter(function(e){return!!e}).join("."):e.nodeName.toLowerCase();return e}return new class{constructor(){this.log=h,this.report={PV:!1,PERFORMANCE:!1,JS_ERROR:!0,XHR_ERROR:!0,CONSOLE_ERROR:!1,TIME_ON_PAGE:!1,LONG_TASK:!1,BLANK_SCREEN:!1}}install(e,t){this.init(t),e.prototype.$webTracker=this}init(e){this.report=n(this.report,e.report||{}),this.config=n(this.config,e),this.log.init(this.config),this._init()}send(e){this.log.send(e)}_init(){var t;window.addEventListener("error",function(e){var t=l;e.target&&(e.target.src||e.target.href)?h.send({logType:"monitor",logCode:"RESOURCE_ERROR",logName:"资源加载错误",filename:e.target.src||e.target.href,tagName:e.target.tagName,elementType:c(e.path||e.target)}):h.send({logType:"monitor",logCode:"JS_ERROR",logName:"JS错误",message:e.message,filename:e.filename,position:(e.lineNo||0)+":"+(e.columnNo||0),stack:d(e.error.stack),elementType:t?c(t.path||t.target):""})},!0),window.addEventListener("unhandledrejection",function(e){var t=l;let n="",o=0,r=0,i="",s="";"string"==typeof e.reason?n=e.reason:"object"==typeof e.reason&&(n=e.reason.message);let a=e.reason;"object"==typeof a&&a.stack&&((e=a.stack.match(/at\s+(.+):(\d+):(\d+)/))&&(i=e[1],o=e[2],r=e[3]),s=d(a.stack)),h.send({logType:"monitor",logCode:"PROMISE_ERROR",logName:"Promise错误",elementType:t?c(t.path||t.target):"",message:n,filename:i,position:o+":"+r,stack:s})},!0),console.error=(t=console.error,function(e){"string"==typeof e?h.send({logType:"monitor",type:"ERROR",logCode:"CONSOLE_ERROR",logName:"控制台错误",message:e,elementType:"page"}):"object"==typeof e&&h.send({logType:"monitor",logCode:"CONSOLE_ERROR",logName:"控制台错误",message:e.message,stack:e.stack,elementType:"page"}),t.call(console,e)}),this.report&&this.report.BLANK_SCREEN&&function(){const t=["body","html","#app"];let o=0;function r(e){e=i(e);0<=t.indexOf(e)&&o++}e(function(){var t,n,e;for(let e=1;e<=9;e++)t=document.elementsFromPoint(window.innerWidth*e/10,window.innerHeight/2),n=document.elementsFromPoint(window.innerWidth/2,window.innerHeight*e/10),r(t[0]),r(n[0]);0<=o&&(e=document.elementsFromPoint(window.innerWidth/2,window.innerHeight/2),h.send({logType:"monitor",logCode:"BLANK_SCREEN",logName:"白屏",emptyPoints:""+o,screen:window.screen.width+"x"+window.screen.height,viewPoint:window.innerWidth+"x"+window.innerHeight,elementType:i(e[0])}))})}(),this.report&&this.report.LONG_TASK&&new PerformanceObserver(e=>{e.getEntries().forEach(e=>{100<e.duration&&requestIdleCallback(()=>{h.send({logType:"monitor",logCode:"LONG_TASK",logName:"卡顿",eventType:lastEvent.type,startTime:g(e.startTime),duration:g(e.duration)})})})}).observe({entryTypes:["longtask"]}),this.report&&this.report.PERFORMANCE&&function(){let p,m;new PerformanceObserver((e,t)=>{e=e.getEntries();p=e[0],t.disconnect()}).observe({entryTypes:["element"]}),new PerformanceObserver((e,t)=>{e=e.getEntries(),e=e[e.length-1];m=e,t.disconnect()}).observe({entryTypes:["largest-contentful-paint"]}),new PerformanceObserver(function(e,t){var n,o=e.getEntries()[0];o&&(n=o.processingStart-o.startTime,e=o.duration,(0<o||0<e)&&h.send({logType:"monitor",logCode:"PERFORMANCE_FIRST_INPUT_DELAY",logName:"第一输入延迟",elementType:"page",inputDelay:n?g(n):0,duration:e?g(e):0,startTime:o.startTime})),t.disconnect()}).observe({type:"first-input",buffered:!0}),e(function(){setTimeout(()=>{var{fetchStart:e,connectStart:t,connectEnd:n,requestStart:o,responseStart:r,responseEnd:i,domLoading:s,domInteractive:a,domContentLoadedEventStart:l,domContentLoadedEventEnd:d,loadEventStart:c}=performance.timing;h.send({logType:"monitor",logCode:"PERFORMANCE_TMING",logName:"性能计时",elementType:"page",connectTime:n-t,ttfbTime:r-o,responseTime:i-r,parseDOMTime:c-s,domContentLoadedTime:d-l,timeToInteractive:a-e,loadTime:c-e});c=performance.getEntriesByName("first-paint")[0],e=performance.getEntriesByName("first-contentful-paint")[0];h.send({logType:"monitor",logCode:"PERFORMANCE_PAINT",logName:"首次绘制",elementType:"page",firstPaint:c?g(c.startTime):0,firstContentPaint:e?g(e.startTime):0,firstMeaningfulPaint:p?g(p.startTime):0,largestContentfulPaint:m?g(m.renderTime||m.loadTime):0})},3e3)})}(),this.report&&this.report.PV&&function(){var e=navigator.connection;h.send({logType:"monitor",logCode:"PV",logName:"PV",elementType:"page",effectiveType:e.effectiveType,rtt:e.rtt,screen:`${window.screen.width}x${window.screen.height}`});let t=Date.now();window.addEventListener("unload",()=>{var e=Date.now()-t;h.send({logType:"monitor",logCode:"STAY_TIME",logName:"在线时长",elementType:"page",stayTime:e})},!1)}()}}}();
