var webTracker=function(){"use strict";let c;function u(e){return`${e}`.split(".")[0]}["click","pointerdown","touchstart","mousedown","keydown","mouseover"].forEach(e=>{document.addEventListener(e,e=>{c=e},{capture:!0,passive:!0})});const r=function(e){return e.reverse().filter(function(e){return e!==window&&e!==document}).map(function(e){e=e.id?`#${e.id}`:e.className&&"string"==typeof e.className?"."+e.className.split(" ").filter(function(e){return!!e}).join("."):e.nodeName;return e}).join(" ")};function d(e){if(Array.isArray(e))return r(e);for(var t=[],n=e;n;)t.push(n),n=n.parentNode;return r(t)}function e(e){"complete"===document.readyState?e():window.addEventListener("load",e)}const t=e=>{console.log(`%c ${e}`,"color:red")};var h=new class{constructor(){this.xhr=new XMLHttpRequest}init(e){this.pcode=e.pcode,this.host=e.host,this.version=e.version,this.project=e.host,this.logstore=e.host,this.url=`http://${e.project}.${e.host}/logstores/${e.logstore}/track`}_getData(){return{pcode:this.pcode,version:this.version,title:document.title,url:location.href,timestamp:Date.now(),userAgent:navigator.userAgent}}_validate(e){return e.pcode?!!e.version||(t("请先设置项目版本号[version]"),!1):(t("请先设置项目代码[pcode]"),!1)}send(e={},t){let n={...this._getData(),...e};for(var r in n)"number"==typeof n[r]&&(n[r]=""+n[r]);this._validate(n)&&(e=JSON.stringify({__logs__:[n]}),this.xhr.open("POST",this.url,!0),this.xhr.setRequestHeader("Content-Type","application/json;charset=UTF-8"),this.xhr.setRequestHeader("x-log-apiversion","0.6.0"),this.xhr.setRequestHeader("x-log-bodyrawsize",e.length),this.xhr.onload=function(){(200<=this.status&&this.status<=300||304==this.status)&&t&&t()},this.xhr.onerror=function(e){console.log("error",e)},this.xhr.send(e))}};function l(e){return e?e.split("\n").slice(1).map(e=>e.replace(/^\s+at\s+/g,"")).join("^"):""}function n(){var n;console.error=(n=console.error,function(e){var t;"string"==typeof e?h.send({kind:"STABILITY",type:"ERROR",errorType:"CONSOLE_ERROR",message:e}):"object"==typeof e&&h.send({kind:"STABILITY",type:"ERROR",errorType:"CONSOLE_ERROR",message:e.message,stack:(t=e.stack)?t.split("\n").slice(1).map(e=>e.replace(/^\s+at\s+/g,"")).join("^"):""}),n.call(console,e)})}function i(e){e=e.id?`#${e.id}`:e.className&&"string"==typeof e.className?"."+e.className.split(" ").filter(function(e){return!!e}).join("."):e.nodeName.toLowerCase();return e}return new class{constructor(){this.log=h,this.config={PV:!1,PERFORMANCE:!1,JS_ERROR:!0,XHR_ERROR:!0,CONSOLE_ERROR:!1,TIME_ON_PAGE:!1,LONG_TASK:!1,BLANK_SCREEN:!1}}init(e){this.config=function(e,t){for(var n in t)e[n]=t[n];return e}(this.config,e),this.log.init(this.config),this._init()}_init(){window.addEventListener("error",function(e){var t=c;e.target&&(e.target.src||e.target.href)?h.send({kind:"STABILITY",type:"ERROR",errorType:"RESOURCE_ERROR",filename:e.target.src||e.target.href,tagName:e.target.tagName,selector:d(e.path||e.target)}):h.send({kind:"STABILITY",type:"ERROR",errorType:"JS_ERROR",message:e.message,filename:e.filename,position:(e.lineNo||0)+":"+(e.columnNo||0),stack:l(e.error.stack),selector:t?d(t.path||t.target):""})},!0),window.addEventListener("unhandledrejection",function(e){var t=c;let n="",r=0,o=0,i="",s="";"string"==typeof e.reason?n=e.reason:"object"==typeof e.reason&&(n=e.reason.message);let a=e.reason;"object"==typeof a&&a.stack&&((e=a.stack.match(/at\s+(.+):(\d+):(\d+)/))&&(i=e[1],r=e[2],o=e[3]),s=l(a.stack)),h.send({kind:"STABILITY",type:"ERROR",errorType:"PROMISE_ERROR",message:n,filename:i,position:r+":"+o,stack:s,selector:t?d(t.path||t.target):""})},!0),n(),this.config&&this.config.BLANK_SCREEN&&function(){const t=["body","html","#app"];let r=0;function o(e){e=i(e);0<=t.indexOf(e)&&r++}e(function(){var t,n,e;for(let e=1;e<=9;e++)t=document.elementsFromPoint(window.innerWidth*e/10,window.innerHeight/2),n=document.elementsFromPoint(window.innerWidth/2,window.innerHeight*e/10),o(t[0]),o(n[0]);0<=r&&(e=document.elementsFromPoint(window.innerWidth/2,window.innerHeight/2),h.send({kind:"STABILITY",type:"BLANK_SCREEN",emptyPoints:""+r,screen:window.screen.width+"x"+window.screen.height,viewPoint:window.innerWidth+"x"+window.innerHeight,selector:i(e[0])}))})}(),this.config&&this.config.LONG_TASK&&new PerformanceObserver(e=>{e.getEntries().forEach(t=>{if(100<t.duration){let e=c;requestIdleCallback(()=>{h.send({kind:"PERFORMANCE",type:"LONG_TASK",eventType:e.type,startTime:u(t.startTime),duration:u(t.duration),selector:e?d(e.path||e.target):""})})}})}).observe({entryTypes:["longtask"]}),this.config&&this.config.PERFORMANCE&&function(){let f,p;new PerformanceObserver((e,t)=>{e=e.getEntries();f=e[0],t.disconnect()}).observe({entryTypes:["element"]}),new PerformanceObserver((e,t)=>{e=e.getEntries(),e=e[e.length-1];p=e,t.disconnect()}).observe({entryTypes:["largest-contentful-paint"]}),new PerformanceObserver(function(e,t){var n,r=c,o=e.getEntries()[0];o&&(n=o.processingStart-o.startTime,e=o.duration,(0<o||0<e)&&h.send({kind:"PERFORMANCE",type:"FIRST_INPUT_DELAY",inputDelay:n?u(n):0,duration:e?u(e):0,startTime:o.startTime,selector:r?d(r.path||r.target):""})),t.disconnect()}).observe({type:"first-input",buffered:!0}),e(function(){setTimeout(()=>{var{fetchStart:e,connectStart:t,connectEnd:n,requestStart:r,responseStart:o,responseEnd:i,domLoading:s,domInteractive:a,domContentLoadedEventStart:c,domContentLoadedEventEnd:d,loadEventStart:l}=performance.timing;h.send({kind:"PERFORMANCE",type:"TMING",connectTime:n-t,ttfbTime:o-r,responseTime:i-o,parseDOMTime:l-s,domContentLoadedTime:d-c,timeToInteractive:a-e,loadTime:l-e});l=performance.getEntriesByName("first-paint")[0],e=performance.getEntriesByName("first-contentful-paint")[0];console.log("FP",l),console.log("FCP",e),console.log("FMP",f),console.log("LCP",p),h.send({kind:"PERFORMANCE",type:"PAINT",firstPaint:l?u(l.startTime):0,firstContentPaint:e?u(e.startTime):0,firstMeaningfulPaint:f?u(f.startTime):0,largestContentfulPaint:p?u(p.renderTime||p.loadTime):0})},3e3)})}(),this.config&&this.config.PV&&function(){var e=navigator.connection;h.send({kind:"PRODUCT",type:"PV",effectiveType:e.effectiveType,rtt:e.rtt,screen:`${window.screen.width}x${window.screen.height}`});let t=Date.now();window.addEventListener("unload",()=>{var e=Date.now()-t;h.send({kind:"PRODUCT",type:"STAY_TIME",stayTime:e})},!1)}()}}}();
